<%- include('../layouts/adminHeader.ejs') %>



<form action="" method="post"  id="offer-form" onsubmit="return offerValidateForm(event)">
    <section class="content-main">
        <div class="row">
            <div class="col-9">

                <div class="content-header">
                    <h2 class="content-title">Add Offer</h2>
                </div>
            </div>
            <div class="d-flex justify-content-end mb-4">
                <a href="/admin/offerList"><button class="btn btn-light rounded font-sm mr-5 text-body hover-up">Save to draft</button></a>
                <input type="submit" value="Add Offer" class="btn btn-md rounded font-sm hover-up">
            </div>
            <div class="col-lg-12">
                
               
             
            </div>
        </div>
        <div class="row">
            <div class="col-lg-6">
                    <div class="card mb-4">
                        <div class="card-body">
                            <div class="mb-4">
                                <label for="category_name" class="form-label">Name</label>
                                <input type="text" name="name" placeholder="Type here" class="form-control" id="offer_name">
                                <div class="error-message" style="color: red;" id="offer_name-error"></div>
                            </div>
                            <div class="mb-4">
                                <div class="form-group">
                                    <label class="form-label" for="discountType">Discount Type:</label>
                                    <select class="form-select" id="discountType" name="discountType">
                                        <option value="percentage">Percentage</option>
                                        <option value="fixed Amount">Fixed Amount</option>
                                    </select><br>
                                    <div class="error-message" style="color: red;" id="discountType-error"></div>

                                </div>
                            </div>
                            <div class="mb-4">
                                <label for="category_name" class="form-label">Discount</label>
                                <input type="number" name="discountValue" placeholder="Type here" class="form-control" id="discount">
                                <div class="error-message" style="color: red;" id="discount-error"></div>
                            </div>
                           
                            <div class="mb-4">
                                <div class="form-group">
                                    <label  class="form-label mt-3"  for="limit">Maximum Redeemable Amount</label>
                                    <input type="number" class="form-control" id="maxReadeemableAmt" name="maxRedeemableAmt" >
                                    <div class="error-message" style="color: red;" id="maxReadeemableAmt"></div>

                                </div>
                            </div>
                          
                           

                        </div>
                    </div> <!-- card end// -->
            </div>
            <div class="col-lg-6">
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="mb-4">
                            <div class="form-group">
                                <label class="form-label mt-3" for="DiscountType">Discount On</label>
                                <select class="form-control" id="discountOn" name="discountOn" >
                                    <option value="product" selected>Product</option>
                                    <option value="category">Category</option>                                    
                                </select>
                                <div class="error-message" style="color: red;" id="discountOn-error"></div>

                            </div>
                        </div>
                        
                        <div id="categorySelect" style="display: none;">
                            <label class="form-label">Category</label>
                            <select name="discountedCategory" class="form-select">
                                <option value="" selected disabled>Select a category</option>
                                <% if (category && category.length > 0) { %>
                                    <% for (let i = 0; i < category.length; i++) { %>
                                        <option value="<%= category[i]._id %>">
                                            <%= category[i].name %>
                                        </option>
                                    <% } %>
                                <% } else { %>
                                    <option value="" disabled>No products available</option>
                                <% } %>
                            </select><br>

                        </div>
                        
                        <div id="productSelect" style="display: none;">
                            <label class="form-label" class="form-label">Product</label>
                            <select name="discountedProduct" class="form-select">
                                <option value="" selected disabled>Select a product</option>
                                <% if (product && product.length > 0) { %>
                                    <% for (let i = 0; i < product.length; i++) { %>
                                        <option value="<%= product[i]._id %>">
                                            <%= product[i].name %>
                                        </option>
                                    <% } %>
                                <% } else { %>
                                    <option value="" disabled>No products available</option>
                                <% } %>
                            </select><br>
                        </div>
                      
                        <!-- Category Div -->
                        <div class="mb-2">
                            <label for="category_name" class="form-label">Start Date</label>
                            <input type="date" name="startDate" placeholder="Type here" class="form-control" id="startDate">
                            <div class="error-message" style="color: red;" id="startDate-error"></div>
                        </div>
                
                        <div class="mb-2">
                            <label for="start date" class="form-label">Expiry Date</label>
                            <input type="date" name="endDate" placeholder="Type here" class="form-control" id="expiryDate">
                            <div class="error-message" style="color: red;" id="expiryDate-error"></div>
                        </div>
                      
                    </div>
                </div> <!-- card end// -->
            </div>
        </div>
   

           
        <div id="errorMessage">
            <% if (typeof errorMessage !== 'undefined' && errorMessage) { %>
              <p class="text-danger" id="message">
                <%= errorMessage %>
              </p>
            <% } %>
          </div>
          
        
        <!-- Display Success Message -->
        <div id="successMessage">
            <% if (typeof successMessage !== 'undefined' && successMessage) { %>
                <p style="color: rgb(8, 96, 0);" id="message">
                    <%= successMessage %>
                </p>
            <% } %>
        </div>
          
        
        </div> 
    
    </section> <!-- content-main end// -->
</form>
<script>
    function offerValidateForm(event) {
    event.preventDefault(); // Prevent the default form submission behavior

    let isValid = true;

    // Reset error messages
    const errorMessages = document.querySelectorAll('.error-message');
    errorMessages.forEach(function (errorMessage) {
      errorMessage.textContent = '';
    });

  
      // Validation for name
      const offerName = document.getElementById('offer_name').value.trim();
      if (!offerName) {
        isValid = false;
        document.getElementById('offer_name-error').textContent = 'Name is required.';
      }
  
      // Validation for discountType
      const discountType = document.getElementById('discountType').value;
      if (!discountType) {
        isValid = false;
        document.getElementById('discountType-error').textContent = 'Discount Type is required.';
      }
  
       // Validation for discount
       const discountValue = document.getElementById('discount').value.trim();
        if (!discountValue) {
            isValid = false;
            document.getElementById('discount-error').textContent = 'Discount is required.';
        } else if (parseFloat(discountValue) < 0) {
            isValid = false;
            document.getElementById('discount-error').textContent = 'Discount cannot be negative.';
        } else if (parseFloat(discountValue) > 100) { // Add validation for discount <= 100
            isValid = false;
            document.getElementById('discount-error').textContent = 'Discount cannot be greater than 100%.';
        }
  
      // Validation for maxRedeemableAmt
      const maxRedeemableAmt = document.getElementById('maxReadeemableAmt').value.trim();
      if (!maxRedeemableAmt) {
        isValid = false;
        document.getElementById('maxRedeemableAmt-error').textContent = 'Maximum Redeemable Amount is required.';
      } else if (parseFloat(maxRedeemableAmt) < 0) {
        isValid = false;
        document.getElementById('maxRedeemableAmt-error').textContent = 'Maximum Redeemable Amount cannot be negative.';
      }
  
      // Validation for discountOn
      const discountOn = document.getElementById('discountOn').value;
      if (!discountOn) {
        isValid = false;
        document.getElementById('discountOn-error').textContent = 'Discount On is required.';
      }
  
      // Validation for selected category or product
      const categorySelect = document.getElementById('categorySelect');
      const productSelect = document.getElementById('productSelect');
  
      if (discountOn === 'category' && categorySelect.style.display !== 'none') {
        const selectedCategory = document.getElementsByName('discountedCategory')[0].value;
        if (!selectedCategory) {
          isValid = false;
          document.getElementById('discountedCategory-error').textContent = 'Please select a category.';
        }
      } else if (discountOn === 'product' && productSelect.style.display !== 'none') {
        const selectedProduct = document.getElementsByName('discountedProduct')[0].value;
        if (!selectedProduct) {
          isValid = false;
          document.getElementById('discountedProduct-error').textContent = 'Please select a product.';
        }
      }
  
      // Validation for startDate
      const startDate = document.getElementById('startDate').value.trim();
      if (!startDate) {
        isValid = false;
        document.getElementById('startDate-error').textContent = 'Start Date is required.';
      }
  
      // Validation for endDate
      const endDate = document.getElementById('expiryDate').value.trim();
      if (!endDate) {
        isValid = false;
        document.getElementById('expiryDate-error').textContent = 'Expiry Date is required.';
      }

  
      // Prevent form submission if validation fails
      if (!isValid) {
      return false;
    }

    // If validation passes, you can submit the form programmatically
    document.getElementById('offer-form').submit();
    }
  </script>
  

<script>
    // Initially display the product select
    document.getElementById('productSelect').style.display = 'block';

    document.getElementById('discountOn').addEventListener('change', function () {
        var categorySelect = document.getElementById('categorySelect');
        var productSelect = document.getElementById('productSelect');

        // Hide both divs by default
        categorySelect.style.display = 'none';
        productSelect.style.display = 'none';

        // Show the selected div
        var selectedOption = this.value;
        if (selectedOption === 'category') {
            categorySelect.style.display = 'block';
        } else if (selectedOption === 'product') {
            productSelect.style.display = 'block';
        }
    });
</script>




  
    


    <%- include('../layouts/adminFooter.ejs') %>
